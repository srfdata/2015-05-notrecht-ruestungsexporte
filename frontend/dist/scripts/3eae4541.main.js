!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}();var akjkj=!0;String.prototype.correctLocaleCompare=function(a,b){b=void 0==b?0:b++;var c=a.length<=this.length?b<a.length-1?!0:!1:b<this.length-1?!0:!1;if(!c)return 0==this[0].localeCompare(a[0])?this.localeCompare(a):this[0].localeCompare(a[0]);if(this.localeCompare(a)!=this[0].localeCompare(a[0])){var d=this.slice(1,this.length),e=a.slice(1,a.length);return d.localeCompare(e)!=d[0].localeCompare(e[0])?d.correctLocaleCompare(e,b):0==this[0].localeCompare(a[0])?d.correctLocaleCompare(e,b):this[0].localeCompare(a[0])}return this.localeCompare(a)},String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){return b=b||0,this.lastIndexOf(a,b)===b}});var SECO_TABLE_COUNT_PER_PAGE=15,SECO_SEARCHABLE_CHART_COUNT=9,server={},data={};data.current={};var ui={},locale={},isMobile=!1;$(function(){console.log("SRF Data here, welcome to the console."),window.isMobile=window.detectDevice(),window.init()}),window.createCookie=function(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=a+"="+b+d+"; path=/"},window.readCookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},window.detectDevice=function(){return $(".device-xs").is(":visible")},window.init=function(){d3.select("body").append("div").attr("class","srfdata-spinner").html("Wird geladen...<br/>").append("i").attr("class","fa fa-spinner fa-spin"),$(window).on("resize",$.throttle(250,function(){console.log("window resized"),window.isMobile=window.detectDevice(),ui.renderAll(),ui.postHeightOfIframe()})),$(window).on("server.dataLoaded",function(){ui.prepare(),ui.renderAll(),ui.renderButtons(),ui.postHeightOfIframe()}),$(window).on("data.filtered",$.throttle(500,function(){console.log("data filtered"),ui.renderAll(),ui.renderButtons(),ui.postHeightOfIframe()})),server.loadData()},locale.de_CH=d3.locale({decimal:".",thousands:"'",grouping:[3],currency:["CHF",""],dateTime:"%A, %d.%m.%Y, %X Uhr",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"]}),locale.abbrVolumeCHF=function(a){var b=a/1e6;if(a>=1e9){var c=b/1e3;return locale.de_CH.numberFormat(",.2g")(c).replace(".0","")+" Mrd."}return a>=1e6?locale.de_CH.numberFormat(",.1f")(b).replace(".0","")+" Mio.":a>=1e5?locale.de_CH.numberFormat(",.2f")(b).replace(".00","")+" Mio.":1e4>a?locale.de_CH.numberFormat(",d")(a).replace("'",""):locale.de_CH.numberFormat(",d")(a)},locale.fullVolumeCHF=function(a){var b=locale.de_CH.numberFormat(",f")(a);return 1e4>a&&(b=b.replace("'","")),"CHF "+b+".-"},ui.elements={},ui.postHeightOfIframe=function(){var a=$("body").height();window.top.postMessage({action:"srf.resize-iframe",height:a+20},"*"),console.log("parent notified of height")},ui.prepare=function(){var a=function(a,b,c,d){var e=this._lookupTable[a],f=this._lookupTableForSuperscript[a],g=this._lookupTableForTooltip[a];this._divs.each(function(){var a=d3.select(this),d=a.select("div.tooltip");if(d.empty()){var h=a.append("div").attr("class","tooltip").style("display","none");h.append("h1").attr("class","category"),h.append("h2").html("Beispiele"),h.append("p").attr("class","examples"),d=h}d.select("h1.category").html(e+"<sup>"+f+"</sup> im Wert von CHF "+locale.abbrVolumeCHF(b)),d.select("p.examples").html(g);var i=parseInt(c)-$(d.node()).height()-25+"px";i=parseInt(i)<0?parseInt(c)+80+"px":parseInt(c)-$(d.node()).height()-0+"px",d.style("top",i),d.style("display","block")})},b=function(a,b,c,d){this._divs.each(function(){var d=d3.select(this),e=d.select("div.tooltip");if(e.empty()){var f=d.append("div").attr("class","tooltip").style("display","none");f.append("h1").attr("class","country"),e=f}e.select("h1.country").html("Exporte nach "+a+" im Wert von CHF "+locale.abbrVolumeCHF(b));var g=parseInt(c)-$(e.node()).height()-25+"px";g=parseInt(g)<0?parseInt(c)+80+"px":parseInt(c)-$(e.node()).height()-0+"px",e.style("top",g),e.style("display","block")})};d3.select(".srfdata-spinner").style("display","none"),d3.select(".container").style("display","block");var c=[(new ui.elements.Catchphrase).dimension(data.dimensions.date).current(data.current)],d=[(new ui.elements.Table).dimension(data.dimensions.date).rowsPerPage(SECO_TABLE_COUNT_PER_PAGE).columns([{label:"Datum",sortable:!0,identifier:"Datum",type:"date"},{label:"Land",sortable:!0,identifier:"Land",type:"string"},{label:"Kategorie",sortable:!0,identifier:"VerzeichnisHaupttyp",type:"string",lookupTable:data.lookup.category},{label:"Exportvolumen",sortable:!0,identifier:"Wert",type:"currency"}])],e=[(new ui.elements.DraggableHistogram).dimension(data.dimensions.date).current(data.current).currentDimension("date").group(data.groups.months).tooltip(!0).round(d3.time.month.round).title("Bewilligtes Exportvolumen nach Monat (in CHF)").xScale(d3.time.scale().domain([new Date(Date.UTC(2012,0,1)),new Date(Date.UTC(2014,11,31))]))],f=[(new ui.elements.SearchableBarchart).dimension(data.dimensions.country).current(data.current).currentDimension("country").group(data.groups.country).title("Nach Land").tooltipFunction(b).numberOfGroups(SECO_SEARCHABLE_CHART_COUNT),(new ui.elements.SearchableBarchart).dimension(data.dimensions.category).current(data.current).currentDimension("category").group(data.groups.category).title("Nach Güterkategorie").tooltipFunction(a).lookupTable(data.lookup.category).lookupTableForSuperscript(data.lookup.directory).lookupTableForTooltip(data.lookup.category_examples).numberOfGroups(SECO_SEARCHABLE_CHART_COUNT)];ui.elements.secoCatchphrases=d3.selectAll(".srfdata-catchphrase").data(c),ui.elements.secoTables=d3.selectAll(".srfdata-table").data(d),ui.elements.secoDraggableHistograms=d3.selectAll(".srfdata-draggable-histogram").data(e),ui.elements.secoSearchableBarcharts=d3.selectAll(".srfdata-searchable-barchart").data(f);var g=[(new ui.elements.FilterButton).filters([{value:[new Date(Date.UTC(2014,2,30)),new Date(Date.UTC(2014,11,31))],label:"date",type:"extent"},{value:"Russland",label:"country",type:"exact"},{value:null,label:"category",type:"exact"}]).dimensions(data.dimensions).current(data.current).label("Konflikt in der Ukraine"),(new ui.elements.FilterButton).filters([{value:null,label:"date",type:"extent"},{value:"Saudi-Arabien",label:"country",type:"exact"},{value:"ML (GKV)14",label:"category",type:"exact"}]).dimensions(data.dimensions).current(data.current).label("Simulatoren an Saudi-Arabien"),(new ui.elements.FilterButton).filters([{value:null,label:"date",type:"extent"},{value:"Katar",label:"country",type:"exact"},{value:null,label:"category",type:"exact"}]).dimensions(data.dimensions).current(data.current).label("Katar rüstet auf"),(new ui.elements.FilterButton).filters([{value:null,label:"date",type:"extent"},{value:null,label:"country",type:"exact"},{value:null,label:"category",type:"exact"}]).dimensions(data.dimensions).current(data.current).label("Alles zurücksetzen")];ui.elements.secoButtons=d3.selectAll(".srfdata-button").data(g)},ui.renderAll=function(){var a=function(a){a.render(d3.select(this))};window.isMobile||ui.elements.secoTables.each(a),ui.elements.secoDraggableHistograms.each(a),ui.elements.secoSearchableBarcharts.each(a),ui.elements.secoCatchphrases.each(a),console.log("ui rerendered")},ui.renderButtons=function(){var a=function(a){a.render(d3.select(this))};ui.elements.secoButtons.each(a),console.log("buttons rerendered")},ui.elements.PresentationElement=function(){this._dimension=null,this._current=null,this._currentDimension=null,this._divs=[],this.dimension=function(a){return arguments.length?(this._dimension=a,this):this._dimension},this.current=function(a){return arguments.length?(this._current=a,this):this._current},this.currentDimension=function(a){return arguments.length?(this._currentDimension=a,this):this._currentDimension}},ui.elements.ResettablePresentationElement=function(){ui.elements.PresentationElement.call(this);var a=this;this._dirty=!1,this._title=null,this._group=null,this._reset=function(){this._dimension.filterAll(),this._dirty=!1,this._current[this._currentDimension]=null,$(window).trigger("data.filtered")},this._setTitle=function(){this._divs.each(function(){var b=d3.select(this),c=b.selectAll("div.title").data([a._title]).enter().append("div").attr("class","title");c.append("h3").text(function(a){return a}),c.append("span").attr("class","reset"),b.selectAll("span.reset").html(function(){return a._dirty?"&times;":""}).on("click",function(){a._dirty&&a._reset()}),c.append("hr")})},this.group=function(a){return arguments.length?(this._group=a,this):this._group},this.title=function(a){return arguments.length?(this._title=a,this):this._title}},ui.elements.Catchphrase=function(){ui.elements.PresentationElement.call(this);var a={date:"vom Januar 2012 bis zum Dezember 2014",category:"militärisch verwendbaren Gütern",volume:"",country:"in 135 Länder"},b=this;computeObjects=function(){var c=_.clone(a),d=_.clone(b._dimension.top(1/0));void 0!==b._current.country&&null!==b._current.country&&(c.country="nach "+b._current.country),void 0!==b._current.category&&null!==b._current.category&&(c.category="Gütern der Kategorie ‹"+data.lookup.category[b._current.category]+"›");var e=_.reduce(d,function(a,b){return a+parseFloat(b.Wert)},0);if(c.volume="CHF "+locale.abbrVolumeCHF(e),void 0!==b._current.date&&null!==b._current.date){var f=_.clone(b._current.date,!0),g=locale.de_CH.timeFormat.utc("%B %Y"),h=f[0],i=f[1];-1!==navigator.userAgent.search(/MSIE 10.0/i)||-1!==navigator.userAgent.search(/MSIE 9.0/i)?i.setMonth(i.getMonth()-1):h.setMonth(h.getMonth()+1),g(h)===g(i)?c.date="im "+g(h):c.date="vom "+g(h)+" bis zum "+g(i)}return c},b.render=function(a){b._divs=a||b._divs;var c=computeObjects(),d=sprintf('«Die Schweiz hat <span class="date">%(date)s</span> den Export von <span class="category">%(category)s</span> im Wert von <span class="volume">%(volume)s</span> <span class="country">%(country)s</span> bewilligt.»',c);b._divs.each(function(){var a=d3.select(this),b=a.select("h1");b.empty()&&(b=a.append("h1")),b.html(d)})}},ui.elements.Table=function(){ui.elements.PresentationElement.call(this);var a=this,b=[],c=20,d=3,e=!1,f=9,g=1,h=1,i=1,j=[],k=function(b){e=d===b?!e:!0,d=b,i=1,a.render()},l=function(a){i=a;var b=j.filter(function(a){return+a.key===i});p(b)},m=function(a){var b=0,d=0,e=d3.nest().key(function(a){return b++%c===0&&d++,""+d}).entries(a);return g=d,e},n=function(){if("string"!==b[d].type){var a=crossfilter.quicksort.by(function(a){return a[b[d].identifier]});a(j,0,j.length)}else j.sort(function(a,c){return a=a[b[d].identifier],c=c[b[d].identifier],b[d].lookupTable&&(a=b[d].lookupTable[a],c=b[d].lookupTable[c]),a.correctLocaleCompare(c)});e||j.reverse(),j=m(j)},o=function(){var a=Math.floor(f/2),b=[];if(h===g||0===g)return b;b.push({label:"< zurück",clickable:i!==h,clickHandler:function(){i!==h&&l(i-1)}}),b.push({label:""+h,clickable:!0,active:i===h,clickHandler:function(a){return function(){l(a)}}(h)}),i-a-1>h&&b.push({label:"...",clickable:!1,active:!1,clickHandler:null});for(var c=[],d=i+a>=g?g-2*a:i-a;i+a>=d;d++)h-1>=d&&a++,d>h&&g>d&&c.push(d);return c.forEach(function(a,c){b.push({label:""+a,clickable:!0,active:i===a,clickHandler:function(a){return function(){l(a)}}(a)})}),g>i+a+1&&b.push({label:"...",clickable:!1,active:!1,clickHandler:null}),b.push({label:""+g,clickable:!0,active:i===g,clickHandler:function(a){return function(){l(a)}}(g)}),b.push({label:"vor >",clickable:i!==g,clickHandler:function(){i!==g&&l(i+1)}}),b},p=function(c){a._divs.each(function(){var a=o(),f=d3.select(this).selectAll("table");if(f.empty()){var f=d3.select(this).append("table").attr("class","table"),g=f.append("thead").append("tr"),h=g.selectAll("th").data(b).enter();h.append("th").attr("class",function(a,b){return a.type}).classed("sortable",function(a,b){return a.sortable}).append("div").on("click",function(a,b){a.sortable===!0&&k(b)}).append("span").text(function(a,b){return a.label});var i=g.selectAll("th").selectAll("div").append("span").attr("class","fa-stack");i.append("i").attr("class","fa fa-stack-1x fa-sort-asc"),i.append("i").attr("class","fa fa-stack-1x fa-sort-desc"),f.append("tbody")}f.selectAll("thead").selectAll("th").classed("active",function(a,b){return b===d}),f.selectAll("thead").selectAll("th i.fa-sort-desc").classed("active",function(a,b){return b===d&&!e}),f.selectAll("thead").selectAll("th i.fa-sort-asc").classed("active",function(a,b){return b===d&&e});var j=f.selectAll("tbody").selectAll("tr").data(c[0].values,function(a,b){return a.ID}),l=j.enter().append("tr"),m=(j.exit().remove(),locale.de_CH.timeFormat.utc("%x"));b.forEach(function(a){l.append("td").attr("class",a.identifier.toLowerCase()+" "+a.type).append("div"),j.selectAll("td."+a.identifier.toLowerCase()).select("div").text(function(b){var c="";return c="date"===a.type?m(b[a.identifier]):"currency"===a.type?locale.fullVolumeCHF(b[a.identifier]):b[a.identifier],a.lookupTable&&(c=a.lookupTable[b[a.identifier]]),c})});j.sort(function(a,c){return a=a[b[d].identifier],c=c[b[d].identifier],b[d].lookupTable&&(a=b[d].lookupTable[a],c=b[d].lookupTable[c]),e?"string"!==b[d].type?d3.ascending(a,c):a.correctLocaleCompare(c):"string"!==b[d].type?d3.descending(a,c):c.correctLocaleCompare(a)}),d3.select(this).selectAll("div.pagination-menu a").remove();var n=d3.select(this).selectAll("div.pagination-menu").data(["always"]),p=(n.enter().append("div").attr("class","pagination-menu"),n.selectAll("a").data(a,function(a,b){return a.label+b}));p.enter().append("a").text(function(a,b){return a.label}),p.classed("clickable",function(a){return a.clickable}),p.classed("active",function(a){return a.active}),p.on("click",function(a){a.clickHandler()})}),console.log("table rerendered")};a.render=function(b){a._divs=b||a._divs,j=a._dimension.top(1/0),n(),i=1;var c=j.filter(function(a){return+a.key===i});0===c.length&&c.push({values:[]}),p(c)},a.columns=function(c){return arguments.length?(b=c,a):b},a.rowsPerPage=function(b){return arguments.length?(c=b,a):c}},ui.elements.DraggableHistogram=function(){ui.elements.ResettablePresentationElement.call(this);var a,b,c=this,d={top:20,right:15,bottom:20,left:15},e=1,f=d3.scale.linear(),g=0,h=d3.svg.axis().orient("bottom"),i=d3.svg.axis().orient("bottom"),j=d3.svg.axis().orient("right"),k=3,l=d3.svg.brush(),m=!1,n=function(c){var d=b?a.domain().map(b):a.domain();return c[0].toString()===d[0].toString()&&c[1].toString()===d[1].toString()};l.on("brush",function(){var d=d3.select(this.parentNode),e=l.extent();b&&(e=e.map(b)),d.select(".brush").call(l.extent(e)),d.select("#clip-"+g+" rect").attr("x",a(e[0])).attr("width",a(e[1])-a(e[0])),(c._dirty||!n(e))&&(n(e)?(c._dimension.filterAll(),c._current[c._currentDimension]=null,c._dirty=!1):(c._dimension.filterRange(e),c._current[c._currentDimension]=e,c._dirty=!0),$(window).trigger("data.filtered"))}),c.render=function(b){void 0!==c._current[c._currentDimension]&&null!==c._current[c._currentDimension]?c._dirty=!0:c._dirty=!1,c._divs=b||c._divs,c._setTitle(),c._divs.each(function(){var b=d3.select(this),m=b.select("g"),n=b.node().getBoundingClientRect().width+d.left+d.right,o=b.node().getBoundingClientRect().height-b.select(".title").node().getBoundingClientRect().height-10;a.range([0,n-d.right-d.left]),f.range([o-d.bottom-d.top,0]);var p=a.range()[1],q=f.range()[0],r=(p-c._group.size()*e*2)/c._group.size();f.domain([0,c._group.top(1)[0].value]);var s=locale.de_CH.timeFormat("%Y").parse;if(l.x(a),h.scale(a),h.tickValues([s("2012")].concat(a.ticks(d3.time.years,1).concat(s("2015")))),h.tickSize(4),i.scale(a),i.tickSize(2),i.tickValues(a.ticks(d3.time.months,1)),i.tickFormat(locale.de_CH.timeFormat("%b")),j.scale(f),j.tickSize(0),j.tickValues(f.ticks(k).slice(1)),j.tickFormat(locale.abbrVolumeCHF),m.empty()){m=b.append("svg").append("g").attr("transform","translate("+d.left+","+d.top+")"),m.append("rect").attr("class","overallBackground"),m.append("clipPath").attr("id","clip-"+g).append("rect"),m.selectAll(".bars").data(["background","foreground"]).enter().append("g").attr("class",function(a){return a+" bars"}),m.selectAll(".bars").selectAll("rect").data(c._group.all()).enter().append("rect").attr("y",d.top),m.selectAll(".foreground.bars").attr("clip-path","url(#clip-"+g+")"),m.append("g").attr("class","x axis"),m.append("g").attr("class","x axis months"),m.append("g").attr("class","y axis");var t=m.append("g").attr("class","brush").call(l);t.selectAll(".resize").append("path").attr("class","cursor-line"),t.selectAll(".resize").append("circle").attr("class","cursor-handle").attr("r",10),t.selectAll(".resize").append("path").attr("class","cursor-handle-nubs").attr("d","M-4,-6V2M0,-6V2M4,-6V2"),t.selectAll(".resize").select("rect").attr("width",20).attr("x",-10)}b.select("svg").attr("width",p+d.left+d.right).style("margin-left",-d.left+"px").attr("height",q+d.top+d.bottom);var u=c._current[c._currentDimension]||l.extent();if(m.select("#clip-"+g+" rect").attr("x",a(u[0])).attr("width",a(u[1])-a(u[0])).attr("height",q),m.select(".brush").selectAll("rect").attr("height",q),m.select(".brush").selectAll("rect.background").attr("width",p),m.select(".brush").selectAll("rect.extent").attr("x",a(u[0])).attr("width",a(u[1])-a(u[0])),m.selectAll(".x.axis").attr("transform","translate(0,"+q+")"),m.select(".brush").selectAll(".resize.e").attr("transform","translate("+a(u[1])+", 0)"),m.select(".brush").selectAll(".resize.w").attr("transform","translate("+a(u[0])+", 0)"),m.select(".x.axis").call(h),m.select(".x.axis.months").call(i),m.select(".y.axis").call(j),m.select("rect.overallBackground").attr("height",q+d.top).attr("transform","translate(0, -"+d.top+")").attr("width",p),m.select(".brush").selectAll(".resize circle.cursor-handle").attr("transform",function(a,b){var c="translate(0,"+(0===b?.8*q:.2*q)+")";return c}),m.select(".brush").selectAll(".resize path.cursor-handle-nubs").attr("transform",function(a,b){var c="translate(0,"+((0===b?.8*q:.2*q)+2)+")";return c}),m.select(".brush").selectAll(".resize path.cursor-line").attr("d","M0,"+-d.top+"V"+q),m.selectAll(".bars").selectAll("rect").attr("x",function(a,b){return b*r+(2*b+1)*e}).attr("y",function(a){return f(a.value)}).attr("width",r).attr("height",function(a){return q-f(a.value)-2<0?0:q-f(a.value)-2}),m.select(".brush").call(l.extent(u)),!c._dirty){l.extent(a.domain());var u=l.extent();l.event(m.selectAll(".brush")),m.selectAll("#clip-"+g+" rect").attr("x",a(u[0])).attr("width",a(u[1])-a(u[0]))}var v=10;m.select(".y.axis").selectAll(".tick").selectAll("rect.shadow").remove(),m.select(".y.axis").selectAll(".tick").select("text").attr("x",v+v/2),m.select(".y.axis").selectAll(".tick").insert("rect","text").attr("x",v).attr("y",-8).attr("width",function(a,b){var c=d3.select(this.parentNode).node().getBoundingClientRect().width;return c+8}).attr("height",16).attr("class","shadow"),m.select(".y.axis").selectAll("line.horizontalGrid").remove(),m.select(".y.axis").selectAll("line.horizontalGrid").data(f.ticks(k).slice(1)).enter().append("line").attr({"class":"horizontalGrid",x2:p,x1:function(a,b){return d3.select(this.parentNode).selectAll(".tick")[0][b].getBoundingClientRect().width+v},y1:function(a){return f(a)},y2:function(a){return f(a)}})})},c.margin=function(a){return arguments.length?(d=a,c):d},c.xScale=function(b){return arguments.length?(a=b,c):x},c.yScale=function(a){return arguments.length?(f=a,c):f},c.round=function(a){return arguments.length?(b=a,c):b},c.tooltip=function(a){return arguments.length?(m=a,c):m}},ui.elements.SearchableBarchart=function(){ui.elements.ResettablePresentationElement.call(this);var a,b=this,c={top:0,right:0,bottom:0,left:0},d=d3.scale.linear(),e=30,f=2,g=null;b._lookupTable=null,b._lookupTableForSuperscript=null,b._lookupTableForTooltip=null;var h=function(a){function c(c){var d=a.filter(function(a,d){var e=b._lookupTable?b._lookupTable[a.key]:a.key;return""!==c&&e.toLowerCase().startsWith(c.toLowerCase())});return d}function d(a,c){b._divs.each(function(){var d=d3.select(this),e=d.select("div.searchFieldContainer"),f=e.select(".resultList").selectAll(".result").data(a,function(a,b){return a.key});f.enter().append("div").attr("class","result"),f.exit().remove(),f.html(function(a,d){var e=b._lookupTable?b._lookupTable[a.key]:a.key;e+=b._lookupTableForSuperscript?"<sup>"+b._lookupTableForSuperscript[a.key]+"</sup>":"";var f=e.substr(0,c.length),g=e.substr(c.length);return"<strong>"+f+"</strong>"+g}).on("mousedown",function(a,c){console.log("click event fired"),b._dimension.filterExact(a.key),b._current[b._currentDimension]=a.key,j(),$(window).trigger("data.filtered")}),f.sort(function(a,c){return a=b._lookupTable?b._lookupTable[a.key]:a.key,c=b._lookupTable?b._lookupTable[c.key]:c.key,a.correctLocaleCompare(c)}),0===a.length?e.select(".resultList").style("display","none"):e.select(".resultList").style("display","block")})}var e=function(b){var e=""!==b?c(b):a;d(e,b)};b._divs.each(function(){var a=d3.select(this),b=a.select("div.searchFieldContainer");$(b.select("input").node()).val(""),b.select("input").on("input",function(){e($(this).val())}).on("focus",function(){e("")}).on("blur",function(){console.log("blur event fired"),$(this).val(""),j()})})},i=function(){b._divs.each(function(){var a=d3.select(this),b=a.select("div.searchFieldContainer");b.style("display","block"),$(b.select("input").node()).focus()})},j=function(){b._divs.each(function(){var a=d3.select(this),b=a.select("div.searchFieldContainer");b.style("display","none")})},k=function(){b._divs.each(function(){var a=d3.select(this),b=a.select("div.tooltip");b.style("display","none")})},l=function(j){b._setTitle(),b._divs.each(function(){var l=d3.select(this),m=l.select("div.chartContainer"),n=l.node().getBoundingClientRect().width;d.range([0,n-c.right-c.left]);var o=d3.max([void 0!==j.topGroups[0]?j.topGroups[0].value:0,void 0!==j.others[0]?j.others[0].value:0]);d.domain([0,o]);var p=d.range()[1],q=(a+1)*e+(a+1)*f;if(m.empty()){m=l.append("div").attr("class","chartContainer").style("left",c.left+"px").style("top",c.top+"px").style("height",q+c.top+c.bottom+"px");var r=m.append("div").attr("class","searchFieldContainer").style("display","none").style("top",function(b,c){var d=a*(e+f);return d+"px"});r.append("div").attr("class","inputContainer").style("height",e+"px").append("input").attr("type","text"),r.select(".inputContainer").append("i").attr("class","fa fa-search"),r.append("div").attr("class","resultList")}j.listOfOthers.length>0&&h(j.listOfOthers),l.select("div.chartContainer").style("width",p+c.left+c.right+"px");var s=m.selectAll(".normalBar").data(j.topGroups,function(a,b){return a.key}),t=m.selectAll(".searchBar").data(j.others,function(a,b){return a.key});s.exit().remove(),t.exit().remove();var u=s.enter().append("div").attr("class","normalBar bar").on("tap",function(a){b._dimension.filterExact(a.key),b._current[b._currentDimension]=a.key,b._dirty=!0,$(window).trigger("data.filtered")}).on("mouseover",function(a){if(g){var c=d3.select(this).style("top");g.call(b,a.key,a.value,c,p)}}).on("mouseout",function(a){g&&k()}),v=t.enter().append("div").attr("class","searchBar bar").on("mouseover",function(a){if(g&&"Andere"!==a.key){var c=d3.select(this).style("top");g.call(b,a.key,a.value,c,p)}}).on("tap",function(a){i()}).on("mouseout",function(a){g&&"Andere"!==a.key&&k()});u.append("div").attr("class","background").style("height",e+"px"),u.append("div").attr("class","foreground").style("height",e+"px"),u.append("span").style("top",e/2-7+"px").style("left","10px").html(function(a,c){var d=b._lookupTable?b._lookupTable[a.key]:a.key;return d+=b._lookupTableForSuperscript?"<sup>"+b._lookupTableForSuperscript[a.key]+"</sup>":""}),v.append("div").attr("class","background").style("height",e+"px"),v.append("div").attr("class","foreground").style("height",e+"px"),v.append("span").style("top",e/2-7+"px").style("left","10px").html(function(a,c){var d=b._lookupTable?b._lookupTable[a.key]:a.key;return d+=b._lookupTableForSuperscript?"<sup>"+b._lookupTableForSuperscript[a.key]+"</sup>":""}),v.append("i").attr("class","fa fa-search"),s.classed("first-child",function(a,b){return 0===b&&a.value>=o}).style("top",function(a,b){var c=b*(e+f);return c+"px"}),t.style("top",function(b,c){var d=a*(e+f);return d+"px"});var w=m.selectAll(".bar");w.style("width",p+"px"),w.selectAll("div").style("position","absolute"),w.select("div.background").style("width",p+"px"),w.select("div.foreground").style("width",function(a,b){return d(a.value)+"px"}),w.select("span").style("width",p-20+"px"),w.selectAll("div").classed("active",function(a){return a.key===b._current[b._currentDimension]}),m.select(".searchFieldContainer").style("width",p+"px"),m.select(".searchFieldContainer").select("input").style("width",p-40+"px")})};b.render=function(c){b._divs=c||b._divs,void 0!==b._current[b._currentDimension]&&null!==b._current[b._currentDimension]?b._dirty=!0:b._dirty=!1;var d=b._group.top(1/0),e=d.filter(function(a){return a.value>0}),f=e.slice(0,a),g=e.slice(a);if(g.length>0){var h={};if(h.key="Andere",h.value=_.reduce(g,function(a,b){return a+parseFloat(b.value)},0),b._dirty){var i=_.some(f,{key:b._current[b._currentDimension]});if(!i){var j=g.filter(function(a,c){return a.key===b._current[b._currentDimension]});j.length>0&&(h=j[0])}}}var e={};e.topGroups=f,0===e.topGroups.length&&(e.topGroups=[]),void 0!==h?(e.others=[h],e.listOfOthers=g):(e.others=[],e.listOfOthers=[]),l(e)},b.numberOfGroups=function(c){return arguments.length?(a=c,b):a},b.lookupTable=function(a){return arguments.length?(b._lookupTable=a,b):b._lookupTable},b.lookupTableForSuperscript=function(a){return arguments.length?(b._lookupTableForSuperscript=a,b):b._lookupTableForSuperscript},b.lookupTableForTooltip=function(a){return arguments.length?(b._lookupTableForTooltip=a,b):b._lookupTableForTooltip},b.tooltipFunction=function(a){return arguments.length?(g=a,b):g}},ui.elements.FilterButton=function(){var a="",b=null,c=null,d=null,e=this,f=null,g=null,h=function(){return _.all(f,function(a,b){return"extent"===a.type?void 0!==d[a.label]&&null!==d[a.label]?null===a.value?!1:_.all(a.value,function(b,c){return b.toString()===d[a.label][c].toString()}):null===a.value:a.value==d[a.label]})};e.render=function(c){b=c||b,b.each(function(){var b=d3.select(this),c=b.select("h1");c.empty()&&(c=b.append("h1"),c.text(a)),b.on("click",function(){h()||(f.forEach(function(a,b){null===a.value?(g[a.label].filterAll(),d[a.label]=null):("extent"===a.type?g[a.label].filterRange(a.value):"exact"===a.type&&g[a.label].filterExact(a.value),d[a.label]=a.value)}),$(window).trigger("data.filtered"))}).classed("active",function(){return h()})})},e.filterFunction=function(a){return arguments.length?(c=a,e):c},e.current=function(a){return arguments.length?(d=a,e):d},e.filters=function(a){return arguments.length?(f=a,e):f},e.label=function(b){return arguments.length?(a=b,e):a},e.dimensions=function(a){return arguments.length?(g=a,e):g}},server.loadData=function(){var a=0;queue(3).defer(d3.csv,"data/exports.csv",function(b){var c=locale.de_CH.timeFormat.utc("%Y-%m-%d");return b.ID=a++,b.Wert=+b.Wert,b.Datum=c.parse(b.Datum),b.VerzeichnisHaupttyp=b.Verzeichnis+b.Haupttyp,b}).defer(d3.csv,"data/export_directories.csv",function(a){return a}).defer(d3.csv,"data/export_categories.csv",function(a){return a.VerzeichnisHaupttyp=a.Verzeichnis+a.Haupttyp,a}).await(function(a,b,c,d){void 0!==a&&null!==a&&console.log(a),data.lookup={},data.lookup.category={},data.lookup.category_examples={},d.forEach(function(a){data.lookup.category[a.VerzeichnisHaupttyp]=a.Beschreibung,data.lookup.category_examples[a.VerzeichnisHaupttyp]=a.Beispiele}),data.lookup.directory={},b=crossfilter(b),d.forEach(function(a){var b="";"5.1"===a.Verzeichnis||"5.2"===a.Verzeichnis||"ChKV"===a.Verzeichnis||"unbekannt"===a.Verzeichnis?b="C":"GKV"===a.Verzeichnis?b="A":"ML (GKV)"===a.Verzeichnis&&(b="B"),data.lookup.directory[a.VerzeichnisHaupttyp]=b}),data.lookup.directory.Andere="",data.lookup.category.Andere="Andere";var e=function(a){return Math.round(a.Wert)};data.dimensions={},data.groups={},data.dimensions.date=b.dimension(function(a){return a.Datum}),data.groups.months=data.dimensions.date.group(d3.time.month),data.groups.months.reduceSum(e),data.dimensions.country=b.dimension(function(a){return a.Land}),data.groups.country=data.dimensions.country.group(),data.groups.country.reduceSum(e),data.dimensions.category=b.dimension(function(a){return a.VerzeichnisHaupttyp}),data.groups.category=data.dimensions.category.group(),data.groups.category.reduceSum(e),console.log("server.dataLoaded fired"),$(window).trigger("server.dataLoaded")})};